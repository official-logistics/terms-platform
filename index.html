<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta name="format-detection" content="telephone=no">
<title>เงื่อนไขและข้อกำหนด - K2PS</title>
<link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
<style>
/* ============================================================
   RESET & BASE
   ============================================================ */
*, *::before, *::after { margin:0; padding:0; box-sizing:border-box; }

:root {
  --navy:#1a3a6b; --navy2:#2952a3; --blue:#2563eb; --blue2:#1d4ed8;
  --orange:#dd6b20; --red:#c0392b; --green:#16a34a;
  --text1:#1a202c; --text2:#4a5568; --muted:#718096;
  --border:#e2e8f0; --bg:#f0f4f8; --card:#fff;
  --note-bg:#fffbeb; --note-border:#f6c94e; --note-text:#744210;
  --bottom-bg:#f7f8fc; --err:#dc2626;

  /* Fluid font scale — ทำงานทุกขนาดหน้าจอ */
  --fs-xs:  clamp(10px, 2.5vw, 12px);
  --fs-sm:  clamp(12px, 3vw,   14px);
  --fs-md:  clamp(13px, 3.5vw, 15px);
  --fs-lg:  clamp(15px, 4vw,   18px);
  --fs-xl:  clamp(17px, 4.5vw, 22px);
}

html {
  -webkit-text-size-adjust: 100%; /* ป้องกัน iOS zoom font */
  text-size-adjust: 100%;
}

body {
  font-family:"Sarabun",sans-serif;
  background:var(--bg);
  color:var(--text1);
  min-height:100vh;
  padding:16px 12px 72px;
  overflow-x:hidden; /* ป้องกัน horizontal scroll */
  -webkit-font-smoothing:antialiased;
}

/* ============================================================
   LAYOUT
   ============================================================ */
.wrap {
  max-width:520px;
  width:100%;
  margin:0 auto;
}

/* CARD SECTIONS */
.sec {
  background:var(--card);
  border-left:1px solid var(--border);
  border-right:1px solid var(--border);
  overflow:hidden; /* ป้องกัน child element ล้น */
}
.sec:first-child {
  border-top:1px solid var(--border);
  border-radius:14px 14px 0 0;
}
.sec-last {
  border-bottom:1px solid var(--border);
  border-radius:0 0 14px 14px;
}
.sep { border-top:1px solid var(--border); }

/* ============================================================
   HEADER
   ============================================================ */
.header { padding:22px 18px 16px; }
.header h1 {
  font-size:var(--fs-xl);
  font-weight:700;
  color:var(--navy);
  line-height:1.45;
  word-break:keep-all; /* ป้องกันตัดคำแปลก */
  overflow-wrap:break-word;
}
.header h1 em { font-style:normal; color:var(--navy2); }
.header .sub {
  font-size:var(--fs-xs);
  color:var(--muted);
  margin-top:8px;
  line-height:1.65;
}

/* ============================================================
   FORM SECTION — stack บนจอเล็กมาก (<320px)
   ============================================================ */
.form-sec {
  padding:18px;
  display:flex;
  gap:14px;
  justify-content:space-between;
  align-items:flex-start;
  flex-wrap:wrap; /* wrap บนจอเล็กมาก */
}
.form-fields {
  flex:1;
  min-width:0; /* ป้องกัน flex child overflow */
  display:flex;
  flex-direction:column;
  gap:11px;
}

/* FIELD GROUP */
.field-group { display:flex; flex-direction:column; gap:4px; }
.field-group label {
  font-size:var(--fs-xs);
  font-weight:600;
  color:var(--navy2);
}
.field-group input {
  border:1.5px solid var(--border);
  border-radius:8px;
  padding:10px 12px;
  font-family:"Sarabun",sans-serif;
  font-size:var(--fs-md); /* ≥13px ป้องกัน iOS auto-zoom เมื่อ focus */
  color:var(--text1);
  background:#fff;
  outline:none;
  width:100%;
  min-width:0;
  -webkit-appearance:none; /* ลบ iOS default style */
  appearance:none;
  transition:border-color 0.15s, box-shadow 0.15s;
}
.field-group input:focus {
  border-color:var(--blue);
  box-shadow:0 0 0 3px rgba(37,99,235,0.12);
}
.field-group input.err { border-color:var(--err); }
.field-group input.ok  { border-color:var(--green); }
.field-group .hint {
  font-size:var(--fs-xs);
  color:var(--muted);
  line-height:1.4;
}
.field-group .errmsg {
  font-size:var(--fs-xs);
  color:var(--err);
  display:none;
  line-height:1.4;
}
.field-group input.err ~ .errmsg { display:block; }

.status-row {
  font-size:var(--fs-sm);
  color:var(--text2);
  margin-top:2px;
}
.status-row .badge { color:var(--orange); font-weight:600; }

/* QR BLOCK */
.qr-block {
  flex-shrink:0;
  display:flex;
  flex-direction:column;
  align-items:center;
  gap:5px;
}
#qr-canvas {
  width:82px; height:82px;
  border-radius:6px;
  border:1px solid var(--border);
  overflow:hidden;
  background:#fff;
  flex-shrink:0;
}
#qr-canvas img    { width:82px !important; height:82px !important; display:block; }
#qr-canvas canvas { width:82px !important; height:82px !important; display:block; }
.qr-label {
  font-size:var(--fs-xs);
  color:var(--muted);
  text-align:center;
  max-width:82px;
  line-height:1.4;
  word-break:keep-all;
}

/* ============================================================
   NOTE YELLOW
   ============================================================ */
.note-yellow {
  background:var(--note-bg);
  border-left:4px solid var(--note-border);
  padding:12px 16px;
}
.note-yellow p {
  font-size:var(--fs-sm);
  color:var(--note-text);
  line-height:1.65;
  overflow-wrap:break-word;
}
.note-yellow strong { color:var(--red); font-weight:700; }

/* ============================================================
   TERMS
   ============================================================ */
.terms-sec { padding:16px 18px; }
.terms-header {
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:12px;
}
.terms-header h2 {
  font-size:var(--fs-lg);
  font-weight:700;
  color:var(--navy);
}
.dots { display:flex; gap:3px; padding:4px; }
.dots span { width:5px; height:5px; background:var(--muted); border-radius:50%; }

.terms-scroll {
  border:1px solid var(--border);
  border-radius:8px;
  max-height:220px;
  overflow-y:auto;
  overflow-x:hidden;
  background:#fafbfc;
  -webkit-overflow-scrolling:touch; /* smooth scroll iOS */
  scrollbar-width:thin;
  scrollbar-color:#cbd5e0 transparent;
}
.terms-scroll::-webkit-scrollbar { width:4px; }
.terms-scroll::-webkit-scrollbar-thumb { background:#cbd5e0; border-radius:4px; }

.term-item {
  font-size:var(--fs-sm);
  color:var(--text2);
  padding:10px 14px;
  border-bottom:1px solid var(--border);
  line-height:1.6;
  overflow-wrap:break-word;
  word-break:break-word;
}
.term-item:last-child { border-bottom:none; }
.term-item .n { color:var(--navy2); font-weight:700; margin-right:4px; }

/* ============================================================
   CHECKBOX
   ============================================================ */
.cb-row {
  padding:14px 18px;
  display:flex;
  align-items:center;
  gap:10px;
}
.cb-row input {
  width:18px; height:18px;
  accent-color:var(--blue);
  cursor:pointer;
  flex-shrink:0;
  /* ทำให้แตะง่ายบนมือถือ */
  min-width:18px; min-height:18px;
}
.cb-row label {
  font-size:var(--fs-sm);
  color:var(--text2);
  cursor:pointer;
  line-height:1.5;
  overflow-wrap:break-word;
}

/* ============================================================
   BUTTON — touch target ≥ 48px ตาม WCAG
   ============================================================ */
.btn-sec { padding:12px 18px 16px; }
.btn-confirm {
  width:100%;
  background:var(--blue);
  color:#fff;
  border:none;
  border-radius:10px;
  padding:15px;
  min-height:50px; /* touch target */
  font-family:"Sarabun",sans-serif;
  font-size:var(--fs-lg);
  font-weight:600;
  cursor:not-allowed;
  opacity:0.45;
  box-shadow:0 4px 14px rgba(37,99,235,0.25);
  transition:background 0.15s, opacity 0.2s, transform 0.1s;
  -webkit-tap-highlight-color:transparent; /* ลบ highlight iOS */
  touch-action:manipulation; /* ป้องกัน double-tap zoom */
}
.btn-confirm.active        { cursor:pointer; opacity:1; }
.btn-confirm.active:hover  { background:var(--blue2); }
.btn-confirm.active:active { transform:scale(0.98); }
.btn-confirm.loading       { cursor:not-allowed; opacity:0.7; }

/* ============================================================
   BOTTOM NOTE
   ============================================================ */
.bottom-note { background:var(--bottom-bg); padding:12px 18px; }
.bottom-note p {
  font-size:var(--fs-xs);
  color:var(--muted);
  line-height:1.75;
  overflow-wrap:break-word;
}

/* ============================================================
   TOAST — ติด safe area บน iPhone มี notch/Dynamic Island
   ============================================================ */
.toast {
  position:fixed;
  bottom:calc(20px + env(safe-area-inset-bottom));
  left:50%;
  transform:translateX(-50%) translateY(80px);
  background:#1e293b;
  color:#fff;
  border-radius:10px;
  padding:12px 20px;
  font-size:var(--fs-sm);
  opacity:0;
  transition:all 0.3s;
  z-index:999;
  white-space:nowrap;
  pointer-events:none;
  max-width:calc(100vw - 32px);
  overflow:hidden;
  text-overflow:ellipsis;
}
.toast.show    { opacity:1; transform:translateX(-50%) translateY(0); }
.toast.success { background:var(--green); }
.toast.error   { background:var(--err); }

/* ============================================================
   RESPONSIVE BREAKPOINTS
   ============================================================ */

/* จอเล็กมาก เช่น iPhone SE (320px) */
@media (max-width: 360px) {
  body { padding:12px 8px 60px; }
  .header { padding:18px 14px 14px; }
  .form-sec { padding:14px; gap:10px; }
  .terms-sec { padding:14px; }
  .cb-row { padding:12px 14px; }
  .btn-sec { padding:10px 14px 14px; }
  .bottom-note { padding:10px 14px; }
  #qr-canvas,
  #qr-canvas img,
  #qr-canvas canvas { width:72px !important; height:72px !important; }
  .qr-block { max-width:72px; }
}

/* จอกว้างปานกลาง เช่น tablet */
@media (min-width: 600px) {
  body { padding:32px 24px 80px; }
  .wrap { max-width:560px; }
  .form-sec { padding:24px; }
  .terms-sec { padding:22px 24px; }
}

/* iPad และใหญ่กว่า */
@media (min-width: 768px) {
  .wrap { max-width:580px; }
}

/* Landscape มือถือ — ลด padding แนวตั้ง */
@media (max-height: 500px) and (orientation: landscape) {
  body { padding:10px 16px 40px; }
  .header { padding:14px 18px 10px; }
  .terms-scroll { max-height:160px; }
}
</style>
</head>
<body>
<div class="wrap">

<!-- HEADER -->
<div class="sec header">
  <h1>เงื่อนไขและ<em>ข้อกำหนด</em><br>ในการซื้อขาย</h1>
  <p class="sub">กรุณากรอกข้อมูลและอ่านเงื่อนไขด้านล่างให้ครบถ้วนก่อนดำเนินการ</p>
</div>

<!-- FORM -->
<div class="sec sep form-sec">
  <div class="form-fields">

    <div class="field-group">
      <label>ชื่อ-นามสกุล *</label>
      <input type="text" id="inp-name"
             placeholder="กรอกชื่อ-นามสกุล"
             oninput="validate()"
             autocomplete="name"
             enterkeyhint="next">
      <span class="errmsg">กรุณากรอกชื่อ-นามสกุล (อย่างน้อย 3 ตัวอักษร)</span>
    </div>

    <div class="field-group">
      <label>รหัสผู้ขาย *</label>
      <input type="text" id="inp-code"
             placeholder="เช่น KPS-001234"
             oninput="fmtCode(this); validate()"
             maxlength="11"
             autocomplete="off"
             inputmode="numeric"
             enterkeyhint="next">
      <span class="hint">พิมพ์ตัวเลข 6 หลัก ระบบใส่ KPS- ให้อัตโนมัติ</span>
      <span class="errmsg">รูปแบบรหัสไม่ถูกต้อง เช่น KPS-001234</span>
    </div>

    <div class="field-group">
      <label>ยอดขายครั้งแรก (บาท) *</label>
      <input type="text" id="inp-amount"
             placeholder="เช่น 23,000"
             oninput="fmtAmount(this); validate()"
             inputmode="numeric"
             enterkeyhint="done">
      <span class="errmsg">กรุณากรอกยอดขายที่ถูกต้อง</span>
    </div>

    <div class="status-row">สถานะ : <span class="badge">รอยืนยันรับยอดขายครั้งแรก</span></div>
  </div>

  <div class="qr-block">
    <div id="qr-canvas"></div>
    <div class="qr-label">สแกนเพื่อตรวจสอบสถานะ</div>
  </div>
</div>

<!-- NOTE -->
<div class="note-yellow">
  <p><strong>หมายเหตุ</strong> : กรุณากรอกข้อมูลให้ครบถ้วนและถูกต้อง ระบบจะบันทึกข้อมูลทันทีที่กดรับทราบ เพื่อใช้ในการตรวจสอบก่อนเข้าสู่ถัดไป</p>
</div>

<!-- TERMS -->
<div class="sec sep terms-sec">
  <div class="terms-header">
    <h2>กฎและเงื่อนไขในการซื้อขาย</h2>
    <div class="dots"><span></span><span></span><span></span></div>
  </div>
  <div class="terms-scroll">
    <!-- ✏️ แก้/เพิ่มข้อความเงื่อนไขได้ที่นี่ -->
    <div class="term-item"><span class="n">1.</span> สมาชิกใหม่ทุกท่านต้องดำเนินการสร้างเครดิตบัญชีตามขั้นตอนและระยะเวลาที่ระบบกำหนด โดยการสร้างเครดิตและการทำรายการเบิกถอนเงินทุนจะเป็นไปตามรอบที่ระบบกำหนดเท่านั้น</div>
    <div class="term-item"><span class="n">2.</span> หากกระบวนการสร้างเครดิตบัญชียังไม่เสร็จสมบูรณ์ สมาชิกจะไม่สามารถดำเนินการเบิกถอนเงินทุนได้จนกว่าระบบจะยืนยันสถานะเรียบร้อย</div>
    <div class="term-item"><span class="n">3.</span> หากสมาชิกดำเนินการผิดพลาดหรือไม่เป็นไปตามขั้นตอนที่ระบบแจ้ง สมาชิกจะต้องดำเนินการแก้ไขให้ถูกต้องตามแนวทางที่ระบบกำหนด และในกรณีที่ยังไม่ดำเนินการแก้ไขหรือแก้ไขไม่ถูกต้อง ระบบอาจกำหนดแผนการแก้ไขเพิ่มเติมตามความเหมาะสม ซึ่งสมาชิกตกลงปฏิบัติตามโดยไม่มีข้อโต้แย้งใด ๆ</div>
    <div class="term-item"><span class="n">4.</span> สมาชิกต้องดำเนินการสร้างเครดิตบัญชีทุกขั้นตอนให้แล้วเสร็จภายในระยะเวลาที่กำหนด มิฉะนั้นระบบอาจระงับสิทธิ์ชั่วคราวจนกว่าจะดำเนินการครบถ้วน</div>
    <div class="term-item"><span class="n">5.</span> ห้ามดำเนินการใด ๆ นอกเหนือจากคำแนะนำของระบบ การสร้างเครดิตบัญชีในรอบสุดท้ายต้องดำเนินการตามที่แจ้งไว้เท่านั้น หากเกิดข้อผิดพลาดต้องแก้ไขตามขั้นตอนที่ระบบกำหนด
(กรณีที่ทำผิดพลาดระบบจะแจ้งให้สร้างเครดิตเพิ่ม 3 ถึง 6 ครั้ง)</div>
    <div class="term-item"><span class="n">6.</span> เมื่อการสร้างเครดิตบัญชีเสร็จสมบูรณ์ การเบิกถอนเงินทุนต้องเป็นไปตามเงื่อนไขของแพลตฟอร์ม รวมถึงการคงค่าดำเนินการในอัตราที่กำหนด และหากทำรายการผิดพลาดต้องดำเนินการแก้ไขตามคำแนะนำของระบบก่อนทำรายการใหม่</div>
    <div class="term-item"><span class="n">7.</span> กรณีผู้ขายยกเลิกการขายภายหลังผู้ซื้อชำระเงินแล้ว บริษัทในฐานะตัวกลางขอใช้สิทธิ์ตามข้อตกลงและกฎหมายที่เกี่ยวข้อง เพื่อป้องกันความเสียหายและการเรียกร้องจากผู้ซื้อ โดยอาจเรียกให้ผู้ขายชำระค่าชดเชยสูงสุดไม่เกินห้า (5) เท่าของมูลค่าสินค้า ตามเงื่อนไขที่ได้ยอมรับไว้ล่วงหน้า</div>
    <div class="term-item"><span class="n">8.</span> กรณีมีการเปลี่ยนแปลงบัญชีธนาคารหรือข้อมูลธุรกรรมระหว่างกระบวนการ สมาชิกต้องยืนยันตัวตนตามขั้นตอนที่ระบบกำหนดก่อนการรับยอดเงินทั้งหมด</div>
    <div class="term-item"><span class="n">9.</span> ระหว่างการสร้างเครดิตบัญชี สมาชิกต้องติดตามและปฏิบัติตามขั้นตอนของระบบอย่างต่อเนื่อง ห้ามขาดการติดต่อหรือหยุดดำเนินการโดยพลการ</div>
    <div class="term-item"><span class="n">10.</span> เมื่อสมาชิกกดยอมรับเงื่อนไขแล้ว จะถือว่ายินยอมตามข้อกำหนดทั้งหมด และไม่สามารถยกเลิกหรือยุติกระบวนการภายหลังได้ในทุกกรณี</div>
    <!-- เพิ่มข้อใหม่:
    <div class="term-item"><span class="n">11.</span> ข้อความของคุณ</div>
    -->
  </div>
</div>

<!-- CHECKBOX -->
<div class="sec sep cb-row">
  <input type="checkbox" id="agree" onchange="validate()">
  <label for="agree">ข้าพเจ้าได้อ่านและยอมรับเงื่อนไขทั้งหมดแล้ว</label>
</div>

<!-- BUTTON -->
<div class="sec sep btn-sec">
  <button class="btn-confirm" id="confirmBtn" type="button" onclick="submitData()">
    รับทราบและพร้อมยืนยันรับยอดขาย
  </button>
</div>

<!-- BOTTOM NOTE -->
<div class="sec sec-last bottom-note">
  <p>ข้อมูลที่กรอกจะถูกบันทึกลงระบบ Escrow เพื่อใช้ในการตรวจสอบและยืนยัน<br>
  ระบบ Escrow K2PS คุ้มครองทั้งผู้ซื้อและผู้ขายทุกรายการ</p>
</div>

</div><!-- /wrap -->
<div class="toast" id="toast"></div>

<script>
// ================================================================
// CONFIG
// ================================================================
const SHEET_URL = 'https://script.google.com/macros/s/AKfycbyH5i1voAtnPXun6ph2WS_bI8s_SHXDZWVd1im91l8JlxM8TF7WGdV1O4Z06eRbjm7S/exec';
const LINE_URL  = 'https://line.me/ti/p/Rpvv6sGPQY';

let isSubmitting = false;

// ================================================================
// Validation
// ================================================================
function validate() {
  const name   = document.getElementById('inp-name').value.trim();
  const code   = document.getElementById('inp-code').value.trim();
  const amount = document.getElementById('inp-amount').value.replace(/,/g, '').trim();
  const agreed = document.getElementById('agree').checked;

  const nameOk   = name.length >= 3;
  const codeOk   = /^KPS-\d{6}$/.test(code);
  const amountOk = /^\d+$/.test(amount) && parseInt(amount) > 0;

  setFieldState('inp-name',   nameOk,   name.length > 0);
  setFieldState('inp-code',   codeOk,   code.length > 0);
  setFieldState('inp-amount', amountOk, amount.length > 0);

  const allOk = nameOk && codeOk && amountOk && agreed;
  document.getElementById('confirmBtn').classList.toggle('active', allOk);
  return allOk;
}

function setFieldState(id, isOk, hasInput) {
  const el = document.getElementById(id);
  el.classList.toggle('err', !isOk && hasInput);
  el.classList.toggle('ok',   isOk && hasInput);
}

// ================================================================
// Format รหัสผู้ขาย → KPS-XXXXXX (6 หลัก)
// ================================================================
function fmtCode(el) {
  const digits = el.value.replace(/[^0-9]/g, '').slice(0, 6);
  el.value = digits.length > 0 ? 'KPS-' + digits : '';
}

// ================================================================
// Format ยอดขาย → 23,000
// ================================================================
function fmtAmount(el) {
  const raw = el.value.replace(/[^0-9]/g, '');
  el.value = raw ? parseInt(raw).toLocaleString('th-TH') : '';
}

// ================================================================
// Submit → Sheet → LINE
// ================================================================
function submitData() {
  if (!validate() || isSubmitting) return;

  isSubmitting = true;
  const btn = document.getElementById('confirmBtn');
  btn.classList.remove('active');
  btn.classList.add('loading');
  btn.textContent = 'กำลังบันทึก...';

  const payload = {
    name:      document.getElementById('inp-name').value.trim(),
    code:      document.getElementById('inp-code').value.trim(),
    amount:    document.getElementById('inp-amount').value.trim(),
    timestamp: new Date().toLocaleString('th-TH', { timeZone: 'Asia/Bangkok' }),
    status:    'รับทราบแล้ว'
  };

  fetch(SHEET_URL, {
    method:  'POST',
    mode:    'no-cors',
    headers: { 'Content-Type': 'application/json' },
    body:    JSON.stringify(payload)
  })
  .catch(() => {})
  .finally(() => { window.location.href = LINE_URL; });
}

// ================================================================
// Generate QR
// ================================================================
window.addEventListener('load', function () {
  if (typeof QRCode !== 'undefined') {
    new QRCode(document.getElementById('qr-canvas'), {
      text:         SHEET_URL,
      width:        82,
      height:       82,
      colorDark:    '#1a3a6b',
      colorLight:   '#ffffff',
      correctLevel: QRCode.CorrectLevel.M
    });
  }
});
</script>
</body>
</html>
